generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model ConnectionTest {
  id Int @id @default(autoincrement())
}

model User {
  id               String    @id @default(uuid())
  email            String    @unique
  password         String
  fullName         String
  phone            String?
  username         String    @unique
  role             String?   @default("user")
  isActive         Boolean   @default(true)

  // Personal Info
  firstName        String?
  middleName       String?
  lastName         String?
  prefix           String?
  suffix           String?
  preferredName    String?
  maidenName       String?
  pronouns         String?
  title            String?
  company          String?
  department       String?
  affiliation      String?
  headline         String?
  accreditations   String?
  emailLink        String?
  phoneLink        String?
  location         String?
  cardName         String?
  cardType         String?   @default("Personal")
  selectedDesign   String?   @default("Classic")
  selectedColor    String?   @default("#145dfd")
  selectedFont     String?   @default("Arial, sans-serif")
  profileImage     String?   @db.Text
  bannerImage      String?   @db.Text
  bio              String?   @db.Text
  status           String?   @default("draft")
  views            Int       @default(0)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  cards            Card[]    @relation("UserCards")
  receivedMessages Message[] @relation("ReceivedMessages")
  sentMessages     Message[] @relation("SentMessages")
  sentConnections  Connection[] @relation("SentConnections")
  receivedConnections Connection[] @relation("ReceivedConnections")
   cardConnections  CardConnection[] @relation("CardConnectionOwner")

  @@index([username])
  @@map("users")
}

model Admin {
  id          String    @id @default(uuid())
  email       String    @unique
  password    String
  fullName    String
  role        AdminRole @default(SUB_ADMIN)
  permissions String    @db.Text
  isActive    Boolean   @default(true)
  createdBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  lastLogin   DateTime?

  @@map("admins")
}

model AdminSession {
  id        String   @id @default(uuid())
  adminId   String
  token     String   @unique @db.VarChar(1000)
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@map("admin_sessions")
}

model Message {
  id         String        @id @default(cuid())
  text       String        @db.Text
  topic      String        @default("Other")
  senderId   String
  receiverId String
  status     MessageStatus @default(PENDING)
  read       Boolean       @default(false)
  tag        MessageTag    @default(PRICING)
  createdAt  DateTime      @default(now())
  receiver   User          @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User          @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
  @@map("messages")
}

model Card {
  id               String   @id @default(cuid()) @map("id")
  userId           String   @map("user_id")
  
  // Personal Information
  fullName         String   @map("full_name") @db.VarChar(255)
  firstName        String?  @map("first_name") @db.VarChar(100)
  middleName       String?  @map("middle_name") @db.VarChar(100)
  lastName         String?  @map("last_name") @db.VarChar(100)
  prefix           String?  @db.VarChar(20)
  suffix           String?  @db.VarChar(20)
  preferredName    String?  @map("preferred_name") @db.VarChar(100)
  maidenName       String?  @map("maiden_name") @db.VarChar(100)
  pronouns         String?  @db.VarChar(50)
  
  // Professional Information
  title            String?  @db.VarChar(255)
  company          String?  @db.VarChar(255)
  department       String?  @db.VarChar(100)
  affiliation      String?  @db.VarChar(255)
  headline         String?  @db.VarChar(500)
  accreditations   String?  @db.Text
  
  // Contact Information
  email            String?  @db.VarChar(320)
  phone            String?  @db.VarChar(50)
  emailLink        String?  @map("email_link") @db.VarChar(500)
  phoneLink        String?  @map("phone_link") @db.VarChar(500)
  location         String?  @db.VarChar(255)
  linkedinUrl      String?  @map("linkedin_url") @db.VarChar(2048)
  websiteUrl       String?  @map("website_url") @db.VarChar(2048)

  // Card Customization
  cardName         String?  @map("card_name") @db.VarChar(100)
  cardType         String?  @map("card_type") @default("Personal") @db.VarChar(50)
  selectedDesign   String?  @map("selected_design") @default("Classic") @db.VarChar(50)
  selectedColor    String?  @map("selected_color") @default("#145dfd") @db.VarChar(20)
  selectedColor2   String?  @map("selected_color2") @default("#00c0fd") @db.VarChar(20)
  selectedFont     String?  @map("selected_font") @default("Arial, sans-serif") @db.VarChar(100)
  displayTypes     String?  @map("display_types") @db.Text
  
  // Media
  profileImage     String?  @map("profile_image") @db.VarChar(2048)
  bannerImage      String?  @map("banner_image") @db.VarChar(2048)
  coverImage       String?  @map("cover_image") @db.VarChar(2048)
  documentUrl      String?  @map("document_url") @db.VarChar(2048)
  
  // Content
  bio              String?  @db.Text
  description      String?  @db.Text
  
  // Card Sections
  skills           String?  @db.Text
  portfolio        String?  @db.Text
  experience       String?  @db.Text
  services         String?  @db.Text
  review           String?  @db.Text

  // Metadata
  status           String?  @default("draft") @db.VarChar(20)
  views            Int      @default(0)

  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  user             User     @relation("UserCards", fields: [userId], references: [id], onDelete: Cascade)
  connections      CardConnection[]

  @@index([userId])
  @@index([createdAt])
  @@map("cards")
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique @db.VarChar(255)
  description String?  @db.Text
  icon        String   @default("Briefcase") @db.VarChar(50)
  color       String   @default("#3B82F6") @db.VarChar(7)
  tags        String   @db.LongText
  isActive    Boolean  @default(true)
  userCount   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([name])
  @@index([isActive])
  @@map("categories")
}

model Connection {
  id         String            @id @default(uuid())
  senderId   String
  receiverId String
  status     ConnectionStatus  @default(PENDING)
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt

  sender     User              @relation("SentConnections", fields: [senderId], references: [id], onDelete: Cascade)
  receiver   User              @relation("ReceivedConnections", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@index([senderId])
  @@index([receiverId])
  @@index([status])
  @@map("connection_requests") // matches their naming convention
}

model CardConnection {
  id          String   @id @default(uuid())
  cardId      String   @map("card_id")
  ownerUserId String?  @map("owner_user_id")
  name        String   @db.VarChar(255)
  email       String   @db.VarChar(320)
  phone       String   @db.VarChar(50)
  sourceUrl   String?  @map("source_url") @db.VarChar(2048)
  createdAt   DateTime @default(now()) @map("created_at")

  card        Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  owner       User?    @relation("CardConnectionOwner", fields: [ownerUserId], references: [id], onDelete: Cascade)

  @@index([cardId])
  @@index([ownerUserId])
  @@index([createdAt])
  @@map("card_connections")
}

enum ConnectionStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
  SUB_ADMIN
}

enum MessageStatus {
  NEW
  READ
  REPLIED
  PENDING
  ARCHIVED
  DELETED
}

enum MessageTag {
  LEAD
  SUPPORT
  PRICING
  FEEDBACK
}
